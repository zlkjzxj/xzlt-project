<!DOCTYPE html>
<html xmlns:shiro="http://www.pollix.at/thymeleaf/shiro" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <title>用户列表--layui后台管理模板 2.0</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="/static/layui/css/layui.css" media="all"/>
    <link rel="stylesheet" href="/static/css/public.css" media="all"/>
    <style>
        /*.layui-table-cell {*/
        /*height: 102px;*/
        /*line-height: 102px;*/
        /*}*/
        tbody tr td .layui-table-cell {
            height: 102px;
            line-height: 102px;
        }
    </style>

</head>
<body class="childrenBody">
<form class="layui-form">
    <input type="hidden" id="userId" th:value="${session.loginUserId}"/>
    <input type="hidden" id="projectId"/>
    <input id="departVal" type="hidden">
    <blockquote class="layui-elem-quote quoteBox">
        <form class="layui-form">
            <div class="layui-input-inline">
                <input type="text" class="layui-input searchVal" style="width: 300px;"
                       placeholder="搜索条件：企业名称|企业负责人|电话"/>
            </div>
            <!--<div class="layui-input-inline">-->
            <!--<select class="state" id="htqdSelect">-->
            <!--<option value="">合同签订</option>-->
            <!--<option value="0">未完成</option>-->
            <!--<option value="1">完成</option>-->
            <!--</select>-->
            <!--</div>-->
            <div class="layui-inline">
                <a class="layui-btn search_btn" data-type="reload">搜索</a>
            </div>
            <div class="layui-inline">
                <a class="layui-btn layui-btn-normal add_btn">添加</a>
            </div>
            <div class="layui-inline">
                <a class="layui-btn layui-btn-normal edit_btn">编辑</a>
            </div>
            <!-- <div class="layui-inline">
                 <a class="layui-btn layui-btn-danger delAll_btn">删除</a>
             </div>-->
        </form>
    </blockquote>
    <table id="projectList" lay-filter="projectList"></table>

    <!--操作-->
    <script type="text/html" id="newsListBar">
        <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
        <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="del">删除</a>
        <a class="layui-btn layui-btn-xs layui-btn-primary" lay-event="look">预览</a>
    </script>
</form>
<script type="text/javascript" src="/static/layui/layui.js"></script>
<script>
    layui.config({
        base: '/static/layui'
    }).use(['form', 'layer', 'laydate', 'table', 'laytpl'], function () {
            var form = layui.form,
                layer = layui.layer,
                $ = layui.jquery,
                table = layui.table
            ;
            //项目列表
            var tableIns = table.render({
                elem: '#projectList',
                url: '/phone/listData',
                cellMinWidth: 95,
                page: true,
                height: "full-175",//高度最大化减去125
                limit: 10,
                limits: [10, 20, 30],
                id: "projectList",
                // skin:'nob',
                // size:"sm",
                even: true,
                // toolbar:true,
                autoSort: true,
                // sortType: 'server',
                // title: '宜元中林项目表',//导出Excel的时候会用到
                initSort: {//默认排序
                    field: 'createTime' //排序字段，对应 cols 设定的各字段名
                    , type: 'desc' //排序方式  asc: 升序、desc: 降序、null: 默认排序
                },
                cols: [
                    [
                        {type: "radio", fixed: "left"},
                        {field: 'name', title: '企业名称', align: "left", width: 250},
                        {field: 'manager', title: '企业负责人', align: 'center', width: 150},
                        {field: 'phone', title: '负责人电话', align: 'center', width: 200},
                        {field: 'pjzf', title: '企业评分', align: 'center', width: 150},
                        {field: 'grade', title: '企业星级', align: 'center', width: 150},
                        {field: 'createTime', title: '录入时间', align: 'center', width: 150},
                        {
                            field: 'qrcode', title: '二维码', align: 'center', templet: function (d) {
                                if (d.qrcode != null) {
                                    return '<image src="' + d.qrcode + '" style="width: 100%;height: 100%; text-align: center;" />';
                                }
                            }
                        }
                    ]
                ],
                done: function (res, curr, count) {
                    //监听行双击事件  layui 新版添加，上面是旧版没有这个方法
                    table.on('rowDouble(projectList)', function (obj) {
                        var data = obj.data;
                        console.log(data);
                        var index = layer.open({
                                title: "添加项目",
                                type: 2,
                                area: [($(document).width() - 200) + "px", ($(document).height() - 30) + "px"],
                                // area: 'auto',
                                content: "projectInfo.html",
                                success: function (layero, index) {
                                    var body = layui.layer.getChildFrame('body', index);
                                    body.find("#company").val(data.id);
                                    body.find("#grade").val(data.grade);
                                    body.find("#contacts").val(data.manager);
                                    body.find("#phone").val(data.phone);
                                    body.find("#companyName").val(data.name);
                                }
                            }
                        )
                        layer.full(index);

                        //标注选中样式
                        obj.tr.addClass('layui-table-click').siblings().removeClass('layui-table-click');
                    });
                }
            });

            //搜索
            $(".search_btn").on("click", function () {
                table.reload("projectList", {
                    page: {
                        curr: 1 //重新从第 1 页开始
                    },
                    where: {
                        searchVal: $(".searchVal").val()
                    }
                })
            });
            $(".add_btn").click(function () {
                addObjects('add');

            })
            $(".edit_btn").click(function () {
                var checkStatus = table.checkStatus('projectList'),
                    data = checkStatus.data;
                if (data.length > 0) {
                    addObjects('edit', data[0]);
                } else {
                    layer.msg("请选择需要修改的企业");
                }
            });

            //批量删除
            $(".delAll_btn").click(function () {
                var checkStatus = table.checkStatus('projectList'),
                    data = checkStatus.data;
                if (data.length > 0) {
                    layer.confirm('确定删除选中的企业？', {icon: 3, title: '提示信息'}, function (index) {
                        $.post("/enterprise/del", {
                            id: data[0]['id']
                        }, function (data) {
                            tableIns.reload();
                            layer.close(index);
                        })
                    })
                } else {
                    layer.msg("请选择需要删除的企业");
                }
            })

            function addObjects(type, data) {
                // var h = "750px";
                var title = "添加企业";
                if (type === 'add') {

                } else {
                    title = "编辑企业";
                }
                //修改项目需要判断是否添加人还是修改人
                var index = layui.layer.open({
                        title: title,
                        type: 2,
                        area: [($(document).width() - 200) + "px", ($(document).height() - 30) + "px"],
                        // area: 'auto',
                        content: "info.html?type=" + type,
                        success: function (layero, index) {
                            console.log("success");
                            var body = layui.layer.getChildFrame('body', index);
                            if (type === 'edit') {
                                body.find("#id").val(data.id);
                                body.find("#name").val(data.name);
                                body.find("#number").val(data.number);
                                body.find("#manager").val(data.manager);
                                body.find("#phone").val(data.phone);
                                body.find("#desc").val(data.desc);
                                body.find("#grade").val(data.grade);
                                body.find("#logo").attr("src", data.logo);
                                setTimeout(function () {
                                    body.find("#coding").click();
                                }, 500)

                                form.render();
                            }
                        }
                    }
                )
                layer.full(index);
            }
        }
    )
</script>
</body>
</html>